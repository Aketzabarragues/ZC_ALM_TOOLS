<UserControl x:Class="ZC_ALM_TOOLS.Views.ViewDispositivos"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:core="clr-namespace:ZC_ALM_TOOLS.Core"
             mc:Ignorable="d" 
             d:DesignHeight="500" d:DesignWidth="800">

    <UserControl.Resources>
        <core:ContainsConverter x:Key="ContainsConverter" />
    </UserControl.Resources>
    
    <Grid Background="White">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="#F0F0F0" BorderBrush="#CCCCCC" BorderThickness="0,0,1,0" Padding="15">
            <StackPanel>
                <TextBlock Text="FILTROS" FontWeight="Bold" Foreground="#333333" Margin="0,0,0,5"/>
                <TextBlock Text="Familia de Dispositivos:" Margin="0,0,0,2"/>
                <ComboBox ItemsSource="{Binding Categorias}" 
                          SelectedItem="{Binding CategoriaSeleccionada}"
                          DisplayMemberPath="Name" 
                          Height="28" Margin="0,0,0,20"/>

                <Separator Margin="0,0,0,20"/>

                <TextBlock Text="WORKFLOW DE SINCRONIZACIÓN" FontWeight="Bold" Foreground="#005B96" Margin="0,0,0,10"/>

                <TextBlock Text="Paso 1: Comprobaciones" FontWeight="SemiBold" Margin="0,5,0,2"/>
                <Button Command="{Binding ComparacionCommand}"                         
                        Content="🔍 Comparar con TIA" 
                        Height="35" Margin="0,0,0,10"
                        Background="White" BorderBrush="#5CB85C" Foreground="#5CB85C"/>
                
                <TextBlock Text="Paso 2: Actualización" FontWeight="SemiBold" Margin="0,5,0,2"/>
                <Button Command="{Binding SyncConstantesCommand}" 
                        Content="Comprobar N_MAX (Constantes)" 
                        Height="35" Margin="0,0,0,10"
                        Background="White" BorderBrush="#007ACC" Foreground="#007ACC"/>

            </StackPanel>
        </Border>

        <Grid Grid.Column="1" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Text="Previsualización de Datos (JSON vs TIA Portal)" 
                       FontSize="16" FontWeight="Light" Margin="0,0,0,10"/>

            <DataGrid Grid.Row="1" ItemsSource="{Binding ListaDispositivos}"
                      AutoGenerateColumns="False"
                      VirtualizingStackPanel.IsVirtualizing="True"
                      VirtualizingStackPanel.VirtualizationMode="Recycling"
                      EnableRowVirtualization="True"
                      CanUserAddRows="False" 
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      Background="White">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Nº" Binding="{Binding Numero}" Width="60"/>

                    <DataGridTextColumn Header="Tag" Binding="{Binding Tag}" Width="180" FontWeight="Bold"/>

                    <DataGridTextColumn Header="Descripción" Binding="{Binding Descripcion}" Width="*"/>
                    <DataGridTextColumn Header="Estado" Binding="{Binding Estado}" IsReadOnly="True" Width="200">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="Sincronizado">
                                        <Setter Property="Foreground" Value="Green"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </Trigger>
                                    <DataTrigger Binding="{Binding Estado, Converter={StaticResource ContainsConverter}, ConverterParameter='Modificar'}" Value="True">
                                        <Setter Property="Foreground" Value="OrangeRed"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Estado, Converter={StaticResource ContainsConverter}, ConverterParameter='Nuevo'}" Value="True">
                                        <Setter Property="Foreground" Value="DodgerBlue"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</UserControl>